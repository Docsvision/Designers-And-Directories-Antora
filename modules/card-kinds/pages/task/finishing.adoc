= Настройка завершения заданий

[#autofinish]
== Автоматическое завершение

Для пользовательского вида карточки _Задание_ можно настроить различные варианты завершения. Данные варианты определяются в зависимости от наличия или отсутствия подчиненных заданий.

.Чтобы настроить автоматическое завершение задания:
. Перейдите на вкладку _Завершение заданий_.
. Найдите область _Автоматическое завершение_.
+
В заголовке области отображается подсказка _Разрешено менять в задании_, означающая, что указанные параметры можно изменять непосредственно в карточке задания.
+
.Настройки автоматического завершения задания
image::autofinish-task.png[Настройки автоматического завершения задания]
+
. При помощи переключателя _Завершение при завершении подчиненных_ выберите предпочтительный вариант завершения родительского задания при завершении подчиненных заданий и групп заданий:
+
* *Не завершать* -- автоматического завершения задания не произойдет. Задание может быть завершено только вручную при помощи выполнения соответствующей операции из интерфейса карточки.
+
Значение по умолчанию.
+
* *При завершении всех подчиненных* -- задание будет автоматически завершено, когда завершатся все его подчиненные задания и группы заданий.
* *При завершении любого из подчиненных* -- для завершения родительского задания достаточно завершения любого из подчиненных заданий или группы заданий.
+
. Чтобы при завершении родительского задания автоматически завершались все подчиненные группы заданий (фактически завершаются задания из групп), установите флаг `*При завершении задания автоматически завершать подчиненные группы заданий*`.
+
. Чтобы при завершении родительского задания автоматически завершались все подчиненные задания, установите флаг `*При завершении задания автоматически завершать подчиненные задания*`.
+
По умолчанию флаг не установлен.
+
Родительское задание будет автоматически завершено, если завершение выполняется из дочерней карточки. Чтобы задание завершилось, нужно чтобы из текущего состояния можно было выполнить переход в состояние `Прекратить исполнение`.
+
. Нажмите на кнопку image:buttons/save.png[Сохранить] на ленте справочника.

[#report]
== Добавление отчёта при выполнении задания

При завершении задания пользователем из интерфейса карточки _Задание_, можно потребовать от пользователя выполнения некоторого набора обязательных действий.

Без выполнения данных действий задание завершено не будет. К таким действиям относятся ввод текста отчёта и прикладывание файла отчёта о выполненных работах.

.Чтобы настроить завершение задания:
. Перейдите на вкладку _Завершение заданий_.
. Найдите область _Завершение задания_.
+
В заголовке области отображается подсказка _Разрешено менять в задании_, означающая, что указанные параметры можно изменять непосредственно в карточке задания.
+
.Настройки действий пользователя при завершении задания
image::user-actions-uponfinish.png[Настройки действий пользователя при завершении задания]
+
. Чтобы при завершении задания от пользователя потребовалось ввести отчёт, установите флаг `*Ввести отчёт*`.
+
Для ввода отчёта в разметке карточки необходимо настроить элемент управления xref:layouts/std-ctrl/text.adoc[Текст] с привязкой к расширенным данным: секция `Задание`, Поле `Отчёт`.
+
. Чтобы при завершении задания от пользователя потребовалось приложить файл отчёта, установите флаг `*Добавить файл отчёта*`.
+
Для завершения задания в разметке карточки необходимо настроить элемент управления xref:layouts/std-ctrl/references.adoc[Ссылки] с привязкой к расширенным данным: секция `Задание`, поле `Список ссылок`.
+
Также нужно xref:card-kinds/task/settings-parameters.adoc#links-classification[выбрать] типы ссылок для отчётов в настройках пользовательского вида карточки _Задание_.
+
. Нажмите на кнопку image:buttons/save.png[Сохранить] на ленте справочника.

[#finish-parameters]
== Параметры завершения

Для пользовательских видов карточек _Задание_ в разметку карточки могут быть добавлены поля, которые должны быть заполнены до завершения задания.

определённые требования для выполнения завершения задания настраиваются при помощи параметров завершения.

.Чтобы настроить параметры завершения:
. Перейдите на вкладку _Завершение задания_.
. Найдите область _Параметры завершения_.
+
.Область отображения параметров завершения
image::task-finish-params.png[Область отображения параметров завершения]
+
. Правой кнопкой мыши вызовите контекстное меню.
. Выберите операцию _Добавить_ для добавления системных полей.
+
Настройка расширенных полей производится в xref:layouts/designer.adoc["Конструкторе разметок"].
+
.Выбор коллекционных значений допускается при выполнении следующих условий:
* Коллекционное поле должно быть типа *_RefID_* из табличной секции.
* Коллекционные параметры работают только для полей _Сотрудники_, _Контрагенты_, _Строка конструктора справочников_.
+
Для каждого коллекционного параметра нужно создавать секцию с одним полем.
+
.Пример использования коллекции значений для выбора сотрудников
image::select-employees-collection.png[Пример использования коллекции значений для выбора сотрудников]
+
. Для полей, которые обязательно должны быть заполнены до завершения задания, установите значение *_Обязательно_*.
. Чтобы при завершении задания выводилось предупреждение о незаполненных полях, но задание всё равно можно было завершить, установите *_Желательно_*.
. Если поле должно быть отображено в диалоге завершения, установите флаг `*Отображать в диалоге*`.
. Нажмите на кнопку image:buttons/save.png[Сохранить] на ленте справочника.

[#finish-options-display]
== Отображение вариантов завершения

Поле, которое предполагается использовать в качестве варианта завершения, нужно предварительно добавить в <<finish-parameters,Параметры завершения>>.

Можно использовать только поля со значением типа _Перечисление_ или _Ссылка на Конструктор справочников_. Для _Конструктора справочников_ дополнительно необходимо указать тип записи.

.Чтобы настроить способ отображения вариантов завершения задания в интерфейсе карточки:
. Перейдите на вкладку _Завершение задания_.
. Найдите область _Варианты завершения_.
+
.Область настройки вариантов завершения
image::finishing-options-settings.png[Область настройки вариантов завершения]
+
. Чтобы возможные варианты завершения отображались на ленте карточки в виде набора кнопок, для настройки _Отображать на ленте_ выберите опцию *Набором кнопок*.
+
На ленту карточки _Задание_ пользовательского вида будут добавлены кнопки, количество которых будет соответствовать значениям выбранного поля. Максимально можно добавить 3 кнопки.
+
В случае использования данной настройки, кнопка *Завершить* в карточке будет отсутствовать. Для завершения задания пользователю необходимо воспользоваться одной из кнопок с вариантами завершения, либо выбрать значение из списка.
+
.Пример отображения в карточке кнопок с вариантами завершения
image::finishing-options-card.png[Пример отображения в карточке кнопок с вариантами завершения]
+
. Чтобы возможные варианты завершения отображались в выпадающем списке кнопки *Завершить*, для настройки _Отображать на ленте_ выберите опцию *Списком*.
