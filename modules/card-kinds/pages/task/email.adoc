= Настройка почтовых уведомлений

.{dv} может информировать пользователей о получении и изменении заданий по электронной почте:
* Исполнители заданий могут получать уведомления о поступлении новых заданий -- для заданий с xref:staff/employees/main-tab.adoc#routing[типом маршрутизации] *_Задача Почтового клиента_* или *_Письмо с описанием задания_*.
* Автор задания может получать уведомления об изменении задания (см. руководство администратора приложения {dm}).

Администратор {dv} может настроить шаблоны почтовых уведомлений и перечень информации, включаемой в письма.

[WARNING]
====
Чтобы почтовые уведомления работали, в настройках СУБП должно быть настроено соединение с электронной почтой (см. Руководство администратора модуля {wf}, пункт _Настройка почты_). В справочнике Системные настройки в разделе menu:Почтовый клиент[Настройки администратора] должен быть указан e-mail адрес сервера.
====

[#xslt]
include::partial$excerpts.adoc[tags=xslt]

[#mail-attachments]
== Настройки вложений в письма

Администратор {dv} может определить, какие данные должны включаться в почтовые уведомления для исполнителей заданий.

.Для этого:
. Перейдите на вкладку _Настройка почтовых уведомлений_.
. Измените настройки в области _Настройки вложений_:
* Установите флаг `*Прикладывать основные файлы документа*`, чтобы к письму прикладывались основные файлы документа, по которому создано задание.
+
Если к заданию приложено несколько основных документов, в письмо будут включены файлы только первого.
+
* Установите флаг `*Прикладывать дополнительные файлы документа*`, чтобы к письму прикладывались дополнительные файлы документа, по которому создано задание.
* Установите флаг `*Отображать связанный документ в письме*`, чтобы в письмо добавлялись атрибуты связанного с заданием документа.
+
[WARNING]
====
К письму, содержащему задание на согласование или подписание документов, согласуемые файлы добавляются согласно логике маршрута согласования.

Дополнительные файлы документа к такому письму не прикрепляются. Настройки `*Прикладывать основные файлы документа*` и `*Прикладывать дополнительные файлы документа*` не учитываются.
====
+
.Настройки вложений в E-mail
image::email-attachments-settings.png[Настройки вложений в E-mail]
+
. Сохраните настройки вида задания.

[#max-size]
== Настройка максимального размера вложений

Администратор {dv} может установить максимально допустимый размер суммы всех вложений, которые БП рассылки может приложить к почтовому сообщению.

При превышении данного ограничения часть файлов не отобразится в письме, а письмо по заданию будет дополнено предупреждением `Для вас создано новое задание: не удалось приложить к заданию все приложенные файлы в связи с ограничением размера вложений. Полную информацию по заданию можно получить, открыв карточку {dv}`.

По умолчанию установлено ограничение -- не более `10` Мб вложений.

.Чтобы изменить данное значение:
. Перейдите на вкладку _Настройка почтовых уведомлений_.
. Измените значение параметра _Максимальный размер почтового сообщения (мб)_ в области _Настройки вложений_. Значение указывается в мегабайтах.
+
.Настройка максимального размера вложений
image::mail-attachment-size.png[Настройка максимального размера вложений]
+
. Сохраните настройки вида задания.

[#xslt-for-performer]
== Настройка шаблона почтового уведомления для исполнителя задания

Шаблон почтового уведомления для исполнителя задания используется при формировании содержимого почтовых сообщений, рассылаемых исполнителям заданий с типом маршрутизации *_Задача Почтового клиента_* и *_Письмо с описанием задания_*.

Шаблон представляет собой XSLT-преобразование, которое применяется к XML-документу с данными карточки. В результате должен быть сформирован HTML-документ, которой включается в тело письма.

[NOTE]
====
Код стандартного XSLT-преобразования, а также описание XML-документа, к которому применяется преобразование, см. в xref:admin:appendix/mail-xslt.adoc[разделе] администратрирование.
====

.Чтобы переопределить стандартный шаблон писем собственным:
. Перейдите на вкладку _Настройка почтовых уведомлений_.
. Нажмите кнопку image:buttons/three-dots.png[Три точки] в поле Почтовые уведомления, чтобы открыть диалоговое окно _Редактор кода_.
+
.Редактор кода
image::xslt-editor.png[Редактор кода]
+
. Введете код XSLT-преобразования в редактор.
. Нажмите на кнопку *ОК* и сохраните настройки вида задания.
Чтобы вернуться к стандартному шаблону, удалите собственный код в редакторе.
