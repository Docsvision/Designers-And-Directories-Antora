= Дерево исполнения

== Назначение

Элемент предназначен для наглядного отображения жизненного цикла карточек _Задание_ и _Группа заданий_. Пользуясь данным элементом, пользователь получает возможность как отслеживать выполнение задания, так и выполнять операции с заданием (создавать подчиненные задания).

Элемент применяется в карточках следующих базовых типов: _Задание_, _Группа заданий_, _Документ_.

Управление деревом заданий выполняется из контекстного меню.

.Контекстное меню содержит следующие пункты:
.. Для всех узлов, если есть родительские задания и режим отображения "подчиненные":
+
* Показать дерево полностью.
+
.. Для узла любого типа:
+
* Обновить.
* Свернуть/развернуть узел.
* Свернуть все/развернуть все.
+
.. Для корневого задания и подчиненного:
+
* Новое задание -- создаёт новое дочернее задание.
* Создать группу заданий -- создаёт новую дочернюю группу заданий.
+
.. Только для подчиненных заданий:
+
* Открыть -- открывает выбранную карточку подчиненного задания.
* Создать Группу заданий -- создаёт подчиненную карточку _Группа заданий_.
* Создать Задание -- создаёт подчиненную карточку Задание.
* Удалить -- удаляет выбранную карточку подчиненного задания.
* Копировать -- создаёт копию подчиненного задания.
* Перенести результаты в родительское задание (только в состоянии `Завершено` для заданий второго и выше уровня вложенности) -- копирование отчётов из дочерних заданий в родительские.
+
.. Для групп заданий:
+
* Открыть -- открывает выбранную карточку подчиненной группы заданий.
* Создать Задание -- создаёт подчиненное задание с копированием части полей согласно настройке в _Справочнике видов карточек_ (см. подробнее xref:user:task/advanced-settings.adoc#copy-fields[здесь]).
* Удалить -- удаляет подчиненное задание и _Группу заданий_.
* Свернуть -- сворачивает вложенные элементы _Группы заданий_.
* Развернуть -- разворачивает вложенные элементы _Группы заданий_.

== Отображение в области "Панель инструментов"

.Отображение в области "Панель инструментов"
image::performance-tree-control.png[Отображение в области "Панель инструментов"]

== Отображение в запущенной карточке

В карточке данный элемент управления представлен в виде панели, на которой фиксируются события, связанные с созданием карточки и изменениями её состояний.

В верхней части элемента отображается дерево заданий, в нижней части -- представление для выделенного элемента дерева.

.Отображение в запущенной карточке
image::performance-tree.png[Отображение в запущенной карточке]

Каждая запись может содержать иконку, соответствующую настройке задания.

.Описание иконок
[cols="12%,88",]
|===
|Кнопка |Название
|image:buttons/clock.png[Часы] |Задание просрочено
|image:buttons/exclamation.png[Восклицательный знак] |Задание с высокой важностью
|image:buttons/arrow-down-blue.png[Стрелка вниз] |Задание с низкой важностью
|image:buttons/control.png[Задание на контроле] |Задание на контроле
|===

== Общие

xref:layouts/controls-standard.adoc#common-properties[Общие свойства элементов управления].

== Поведение

Исключить делегатов::
При выборе значения *_Нет_* отображение записей о делегировании разрешено, при выборе значения *_Да_* -- запрещено.

Операции::
В поле задаются операции, которые могут быть выполнены с элементом дерева:
+
* `*Копирование задания*` -- копирование карточки _Задание_.
* `*Создание группы заданий*` -- создание новой связанной карточки _Группа заданий_ для выделенного элемента в дереве.
* `*Создание задания*` -- создание новой связанной карточки _Задание_ для выделенного элемента в дереве.
* `*Удаление группы заданий*` -- удаление связанной карточки _Группа заданий_ для выделенного элемента в дереве.
* `*Удаление задания*` -- удаление связанной карточки _Задание_ для выделенного элемента в дереве.

Столбцы::
В поле задаются названия для отображаемых столбцов. Выбор производится из следующих доступных вариантов:
+
* `*Название*` -- название карточки _Задание_ или _Группа заданий_.
* `*Автор*` -- автор карточки _Задание_ или _Группа заданий_.
* `*Состояние*` -- текущее состояние карточки _Задание_ или _Группа заданий_.
* `*Дата начала плановая*` -- дата, которая была определена автором задания для начала исполнения карточки _Задание_ или _Группа заданий_.
* `*Дата завершения плановая*` -- дата, которая была определена автором задания для завершения исполнения карточки _Задание_ или _Группа заданий_.
* `*Дата начала фактическая*` -- дата, которая была определена исполнителем для начала исполнения задания.
* `*Дата завершения фактическая*` -- дата, которая была определена исполнителем для завершения задания.
* `*Назначенный исполнитель*` -- имя назначенного автором исполнителя для задания.
* `*Текущий исполнитель*` -- имя исполнителя, который на текущий момент работает с заданием.
* `*Исполнитель*` -- имя исполнителя карточки _Задание_ или _Группа заданий_ на момент делегирования задания. Поле заполняется только в записях делегированных заданий.
* `*Делегировал*` -- имя сотрудника, который делегировал задание другому исполнителю.
* `*Причина делегирования*` -- причина делегирования задания:
** Если делегирование происходит вручную, будет отображаться значение `Делегирование`.
** Если задание исполняет не текущий исполнитель, а его заместитель или другой сотрудник, которому разрешено выполнять исполнение задания, то будет отображаться значение `Автоматически`.
* `*Признак возврата*` -- признак необходимости возврата задания с делегирования сотруднику, который делегировал задание.
* `*Возвращено*` -- признак, указывающий, что задание возвращено с делегирования.
* `*Дата делегирования*` -- дата выполнения операции делегирования задания исполнителем.
* `*Иконка состояния*` -- отображение иконки, соответствующей текущему состоянию карточки _Задание_ и _Группа заданий_.
* `*Тип маршрутизации*` -- тип маршрутизации карточки _Группа заданий_.
* `*Ответственный исполнитель*` -- имя сотрудника, для которого в карточке _Группа заданий_ задано значение в поле _Ответственный исполнитель_.
* `*Делегат*` -- имена делегатов задания:
** В узлах _дерева исполнения_, соответствующих основному или подчиненному заданию, в столбце будут отображаться актуальные делегаты задания. Если делегатов несколько, в ячейке таблицы будет отображаться список сотрудников.
** В узлах _дерева исполнения_, соответствующих делегированию, будет отображаться фамилия делегата и информация о том, кому было делегировано задание.
+
Если один из делегировавших сотрудников отменит делегирование, строка, соответствующая факту делегирования, будет удалена из _дерева исполнения_.

Показывать всю иерархию заданий::
В поле определяется вид дерева по умолчанию:
+
* *_Нет_* -- в дереве отображается ветка текущего задания, игнорируются родительские задания и другие ветки.
* *_Да_* -- в дереве отображаются все ветки, начиная с корневой.

Режим переноса результатов::
Определяет способ переноса ссылок из подчиненного задания в родительское при выполнении команды _Перенести результаты в родительское задание_:
+
* *_Создать копию_* -- в родительское задание будут добавлены ссылки на копии карточек (будут созданы при переносе), на которые ссылается подчиненное задание.
* *_Использовать ссылку_* -- в родительское задание будут добавлены ссылки на оригинальные карточки, на которые ссылается подчиненное задание.
* *_Отобразить диалог для выбора режима_* -- пользователю будет предложено самостоятельно выбрать режим переноса результатов (создавать копию или добавлять ссылку).

== Данные

Виды карточек::
Параметр определяет допустимые для отображения в элементе виды карточек _Задание_. Для выбранного вида можно автоматически добавлять дочерние виды. Чтобы воспользоваться данной возможностью, выберите вид в окне _разрешённые типы и виды_, затем вызовите контекстное меню для этого вида и включите опцию _Включая дочерние_. При включении опции, новые создаваемые подчиненные виды автоматически добавляются в элемент управления и становятся доступными для выбора.

Источник данных::
Тип поля данных -- *_RefcardID_* (поле -- ссылка на системную карточку списка заданий). Например, для карточки задания следует выбрать значение *_Задание_*.

Операции состояния::
Для функции дерева (команд) выбираются операции из _Конструктора состояний_. Функции дерева будут доступны в зависимости от настроек автомата состояний и ролевой модели. В поле следует выбрать требуемую операцию:
+
* _Копирование задания_ -- копирование карточки _Задание_.
* _Создание группы заданий_ -- создание новой связанной карточки _Группа заданий_ из открытой карточки _Задание_.
* _Создание задания_ -- создание новой связанной карточки _Задание_ из открытой карточки _Задание_.
* _Удаление группы заданий_ -- удаление связанной карточки _Группа заданий_ из открытой карточки _Задание_.
* _Удаление задания_ -- удаление связанной карточки _Задание_ из открытой карточки _Задание_.

Элемент данных::
Например, для карточки задания следует выбрать _Список подчиненных заданий_.

Ограничение типа ссылок::
Список типов ссылок, которые не должны отображаться в окне настройки переноса результатов из подчиненного задания в родительское (команда _Перенести результаты в родительское задание_).
+
Если типы ссылок не выбраны, пользователь сможет переносить в родительское задание ссылки любых типов.

== Представления узла

Представление делегата::
В поле задаётся желаемый вид представления для делегата. В качестве представлений перечисленных ниже свойств необходимо использовать представления с колонкой _DelegateId_ (чтобы колонка не отображалась, установите опцию `*Скрытая колонка*` в настройках представления).
+
Необходимо настроить колонку на поле *_RowId_* секции _Задание / Список делегирования_. Только в этом случае представление будет отображаться для указанных строк в _Дереве исполнения_.

Представление основного задания::
В поле задаётся желаемый вид представления для основной карточки _Задание_.

Представление дочернего задания::
В поле задаётся желаемый вид представления для дочерней карточки _Задание_.

== Настройка локализации

Допускается xref:layouts/layout-localize.adoc#localize-general[локализация общих свойств] элемента. Описание настройки локализации содержится в разделе xref:layouts/controls-standard.adoc#common-properties[Общие свойства элементов управления].
