= Настройка элементов управления

Элемент, добавленный в карточку, может быть настроен или как _поле_, или как _свойство_. По умолчанию, добавленный в карточку элемент, является _свойством_.

При работе с настроенной карточкой, для полей и свойств будут различаться способы построения поисковых запросов и представлений.

Данные всех свойств хранятся в разделе _Свойства_, который представляет собой таблицу атрибутов выбранного элемента. Работа со свойствами осуществляется через элементы управления карточки, обращающиеся к разделу _Свойства_. Это неэффективно из-за относительно невысокой производительности и затруднений, возникающих при настройке запроса атрибутивного поиска и представления.

Данные _поля_ хранятся в самом поле. Для поля элементы управления, размещенные на карточке в режиме настройки, привязываются не к разделу _Свойства_, а непосредственно к полю. Чтобы выполнить привязку, установите атрибуты *Источник данных* и *Поле данных*. В качестве источника данных выберите раздел карточки, а в качестве поля -- нужное поле из выбранного раздела. После этого, элемент управления будет читать и сохранять данные в указанное поле. Таким образом, атрибутивный поиск по данному полю не будет отличаться от стандартного поиска системы {dv}.

Атрибуты (свойства) категории _Внешний вид_, а также атрибуты *Видимость*, *Только для чтения* и *Обязательное* настраиваются для каждой разметки. Все остальные атрибуты имеют одинаковое значение для всех разметок одного типа карточки.

Во всех элементах, предполагающих выбор значений из справочников, доступен быстрый поиск по подстроке.

.Чтобы настроить элемент управления:
. Выполните любое из действий:
* Дважды щелкните левой клавишей мыши по элементу в области _Разметки_.
* Щелкните правой кнопкой мыши по нужному элементу на панели _Структура разметки_ и выберите пункт _Свойства_, чтобы открыть окно свойств элемента.
+
.Окно свойств элемента управления
image::control-properties.png[Окно свойств элемента управления]
+
. Заполните свойства элемента.
. Чтобы раскрыть полный список свойств элемента, в описанном выше окне нажмите на ссылку _Больше_.
+
Атрибуты сгруппированы по категориям. Часть атрибутов общая для всех элементов управления, для некоторых элементов можно настроить также специфические атрибуты.
+
.Окно расширенных свойств элемента управления
image::control-properties-extended.png[Окно расширенных свойств элемента управления]
+
. Заполните xref:layouts/controls-standard.adoc#common-properties[свойства] элемента.
. Добавьте собственный скрипт для элемента разметки:
+
[lowerroman]
.. Перейдите на вкладку _События_.
+
.Окно событий элемента управления
image::control-events.png[Окно событий элемента управления]
+
.. Выберите строку события, для которого настраивается обработчик.
.. Нажмите кнопку *…* в строке с названием обработчика.
.. Реализуйте метод-обработчик (будет добавлен автоматически) на языке C# или VB .Net (зависит от языка, выбранного для скрипта данного вида карточек).
+
При реализации обработчика доступны *публичные* методы, реализованные в родительских видах данного подвида карточек.
+
.. Сохраните настройки скрипта карточки.
. После завершения настройки данного элемента управления или разметки, сохраните настройки разметки.
+
Заранее настроенные (стандартные) элементы управления в карточках документов и заданий могут быть удалены из разметки. В таком случае они появляются в списке доступных элементов области _Панель инструментов_ после повторного открытия xref:layouts/designer.adoc["Конструктора разметок"], или после повторного выбора вида карточки.

[#data-source]
== Выбрать источник данных

Источник данных для элемента можно выбрать как в первоначальной малой форме свойств, так и в большой форме (после нажатия на _Больше..._).

Источником данных может выступать раздел или элемент метаданных простого ("плоского") типа (обозначен в конструкторе как _Struct_), либо типа _Коллекция значений_ (обозначен в конструкторе как _Table_).

Тип _Table_ позволяет хранить набор значений, благодаря которому можно заполнить с помощью одного элемента сразу некий массив данных (например, столбец в таблице).

.Большинство элементов карточки используют в качестве источника метаданные простого типа:
* Карточка _Документ_:
** Основная информация.
** Системные свойства.
** Хранение.
** Отправители.
* Карточка _Задание_:
** Системные свойства.
** Настройки.
** Задание.
** Настройки завершения.
** Настройки вида подчиненного задания.
** Настройки создания подчиненного задания.

Для элементов xref:layouts/std-ctrl/employees.adoc[Сотрудники], xref:layouts/std-ctrl/table.adoc[Таблица] и xref:layouts/std-ctrl/set-of-values.adoc[Коллекция значений] в качестве источника данных будут предлагаться разделы _коллекционного_ типа.

Пользователь может создать для карточки новые секции и поля -- расширенные метаданные.

[#text-label]
== Настроить текстовую метку

Для каждого элемента, имеющего большую форму свойств, можно настраивать расположение текстовой метки.

Настроить метку можно задав следующие xref:layouts/controls-standard.adoc#common-properties[Общие свойства] элементов управления:

* xref:layouts/controls-standard.adoc#align[Автовыравнивание].
* xref:layouts/controls-standard.adoc#visibility[Видимость].
* xref:layouts/controls-standard.adoc#placement[Местоположение].

[#availability]
== Настроить доступность элемента

Для каждого добавляемого поля можно настроить доступность для различных пользователей.

Настройка доступа к управлению элементом производится в атрибутах элемента, в свойстве *Имя, Операция редактирования* раздела *Данные*.

При добавлении элемента данное свойство не настроено, и поле доступно всем ролям и во всех состояниях. Для регулировки доступности поля следует создать в данном свойстве новую операцию (или выбрать существующую), а затем в _Конструкторе состояний_ и _Конструкторе ролей_ сделать эту операцию доступной или запрещённой.

[#visibility]
== Настроить видимость элемента

По умолчанию, добавленный пользователем в разметку элемент управления, всегда виден, то есть отображается на разметке. При необходимости элемент может быть скрыт.

Настройка видимости определяется свойством *Видимость*, который содержится в группе _Поведение_ xref:layouts/controls-standard.adoc#common-properties[Общих свойств] элементов управления. Свойство имеется у всех элементов, предоставляющих расширенную форму свойств.

Для базовых элементов настройка видимости не поддерживается. Для элементов, которые не являются базовыми, а добавляются в карточку при установке дополнительных модулей и приложений системы (например, _{dm}_), операция скрытия доступна.

[#tab]
== Настроить очередность обхода полей карточки по кнопке Tab

Пользователь может настроить собственную очередность обхода карточки по кнопке kbd:[Tab].

.Чтобы настроить последовательность, в группе _Поведение_ xref:layouts/controls-standard.adoc[Общих свойств] элементов управления предусмотрены свойства:
* xref:layouts/controls-standard.adoc#tab[Переходить по TAB].
* xref:layouts/controls-standard.adoc#order[Порядок обхода].

Чтобы включить возможность перехода по kbd:[Tab], необходимо в свойстве *Переходить по Tab* выбрать значение *_Да_*.

Порядковый номер поля задаётся в свойстве *Порядок обхода*. Номер вводится пользователем вручную. Уникальность введённого номера системой не отслеживается, т.е. пользователь может нескольким полям проставить один и тот же номер. Например, если трем полям задать номер `5` переход к данным полям произойдет после поля с номером `4`, но в произвольном порядке.

Для карточки _Документ_ данные свойства могут использоваться только для пользовательских полей. Для базовых полей данные настройки не будут работать.

Для карточки _Задание_ базовым полям назначены номера порядка обхода с шагом 10, т.е. `10`, `20`, `30` и т.д. Чтобы задать очередность обхода для пользовательских полей, им следует задавать номера, отличные от базовых (`11`, `25` и т.п.).

[#script]
== Написание скрипта для элемента

Пользователь может написать собственные скрипты для каждого элемента, добавленного в разметку.

Чтобы добавить скрипт, необходимо выбрать нужное событие и нажать на кнопку, расположенную в правой части поля.

. Откройте окно свойств элемента.
. Перейдите на вкладку _События_.
+
.Просмотр списка событий элемента
image::control-events.png[Просмотр списка событий элемента]
+
. Нажмите на кнопку image:buttons/three-dots.png[Три точки], расположенную в правой части поля.
+
Будет открыто окно редактирования скрипта.
+
.Окно редактора скриптов
image::script-editor.png[Окно редактора скриптов]
+
. Измените текст скрипта элемента, либо добавьте собственный скрипт.
+
Работа в окне редактирования скрипта выполняется аналогична работе с _Конструктором скриптов_.
+
В нижней части окна расположена кнопка *Компилировать*, запускающая процесс компиляции скриптового класса для текущего типа карточки. По окончании компиляции выдается окно с информацией о результатах.
+
Кнопка *Конструктор* позволяет открыть на чтение _Конструктор скриптов_. Допускается возможность копирования кода.
+
Также окно содержит область для подключения к скрипту дополнительных сборок.
