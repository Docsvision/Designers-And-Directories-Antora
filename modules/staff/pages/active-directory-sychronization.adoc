= Синхронизация с Active Directory

Записи подразделений справочника сотрудников могут синхронизироваться с учетными записями подразделений (Organizational Unity) системы каталогов Active Directory, содержащей доменные учетные записи подразделений, структурированные в соответствии с иерархией организации.

Синхронизация данных справочника сотрудников и Active Directory позволяет поддерживать в них единообразие структуры, при этом передача данных может производиться как из _Справочника сотрудников_ в систему каталогов _Active Directory_, так и из _Active Directory_ в _Справочник сотрудников_. При передаче данных в этом направлении можно автоматически создать личные папки для всех пользователей, а также указать их xref:staff/employees/main-tab.adoc#certificate[сертификаты] для подписания и шифрования файлов.

Производить синхронизацию записей _Справочника сотрудников_ и данных _Active Directory_ может сотрудник, имеющий права на редактирование _Справочника сотрудников_.

С системой каталогов _Active Directory_ можно синхронизировать как весь справочник сотрудников, так и данные об отдельной организации (подразделении) или группе. Настройки являются общими для всех пользователей. Группу, определённую в справочнике сотрудников, можно синхронизировать с доменной группой, но не с локальной группой {dv}.

Настройки синхронизации сохраняются между сессиями (после того, как синхронизация с такими настройками производилась). Все системные сообщения о синхронизации записываются в доступный для просмотра _Журнал синхронизации_. Сохранить данных можно нажатием кнопки *Сохранить лог*.

.Чтобы синхронизировать данные справочника сотрудников и системы каталогов Active Directory:
. Нажмите на панели инструментов справочника кнопку *Синхронизация с Active Directory* image:buttons/synchronize-ad.png[Зелёная и красная стрелки].
+
.Окно "Синхронизация с Active Directory"
image::staff-synch-with-a-d.png[Окно "Синхронизация с Active Directory"]
+
. В окне _Синхронизация с Active Directory_ выберите предпочтительный способ направления синхронизации:
+
* *Внести изменения из AD в справочник* -- в процессе синхронизации данные из домена и подразделения системы каталогов Active Directory, указанного в свойствах организации (источник синхронизации), будут копироваться в справочник сотрудников (приёмник синхронизации).
+
Направление используется по умолчанию.
+
* *Внести изменения из справочника в AD* -- в процессе синхронизации данные будут копироваться из справочника сотрудников (источника синхронизации) в подразделение или домен системы каталогов Active Directory, указанное в свойствах организации (приёник синхронизации).
+
. Чтобы настроить параметры синхронизации, установите или снимите флаги:
+
* `*Синхронизировать подразделения*` -- осуществлять обмен данными о подразделениях организации.
* `*Синхронизировать группы*` -- осуществлять обмен данными о группах организации.
* `*Синхронизировать роли*` -- осуществлять обмен данными о ролях организации.
* `*Синхронизировать добавления и переносы*` -- осуществлять обмен данными о добавленных или перемещенных объектах, если в источник синхронизации с момента предыдущей синхронизации были внесены изменения (добавления и перемещения).
* `*Синхронизировать удаления*` -- осуществлять обмен данными об удалённых объектах, если с момента предыдущей синхронизации из источника синхронизации были удалены какие-либо объекты. Если в источнике синхронизации не будет найдено записи об объекте, он будет удалён из "приёмника" синхронизации, поэтому к синхронизации удаления необходимо относиться с осторожностью.
* `*Создавать папки*` -- при передаче данных автоматически создаются личные папки для всех пользователей. Параметр установлен по умолчанию и доступен только при направлении синхронизации *Из AD в справочник*.
* `*Загружать заблокированные учетные записи*` -- параметр доступен только при направлении синхронизации *Из AD в справочник*. При передаче данных в справочник будут загружаться все записи AD, включая заблокированные.
* `*Не проверять домен сотрудников*` -- параметр по умолчанию не установлен. Используется в случаях, когда требуется игнорировать принадлежность сотрудников к домену. Доступен только для направления *Из справочника в AD*.
* `*Загружать сертификаты*` -- при передаче данных происходит подключение сертификатов пользователей. Параметр доступен только при направлении синхронизации *Из AD в справочник*. Если пользователь имеет несколько сертификатов, из них подключается первый по порядку следования в Active Directory.
+
. В случае необходимости (при нестандартной синхронизации) следует указать соответствие полей справочника сотрудников и атрибутов Active Directory в окне настройки синхронизации. Чтобы открыть окно настроек синхронизации, нажмите кнопку *Настройки...* в окне _Настройка синхронизации с Active Directory_.
+
.. При помощи кнопок *Добавить* image:buttons/plus-green.png[Зелёный плюс] и *Изменить* image:buttons/pencil-green.png[Зелёный карандаш] выберите поля _Справочника сотрудников_, предназначенных для синхронизации.
+
Список соответствий полей и атрибутов Active Directory можно посмотреть http://msdn.microsoft.com/en-us/library/aa746392%28VS.85%29.aspx[здесь].
+
.. После выполнения необходимых настроек нажмите на кнопку *ОК*.
+
.Окно "Настройка синхронизации с Active Directory"
image::staff-a-d-settings.png[Окно "Настройка синхронизации с Active Directory"]
+
. Чтобы запустить синхронизацию данных, нажмите кнопку *Начать*.
+
Если синхронизация занимает длительное время, и требуется её прервать, нажмите кнопку *Остановить*.
+
. Чтобы синхронизировать с системой каталогов Active Directory данные об одной организации (подразделении), группе или роли, выделите на левой панели справочника нужную строку и выберите пункт контекстного меню _Синхронизация с Active Directory_.
+
В открывшемся окне доступны, но по умолчанию не установлены, параметры _Синхронизировать дочерние объекты_, _Синхронизировать группы_ и _Синхронизировать роли_. Если установить эти параметры, синхронизация затронет не только непосредственно выделенный объект (организацию, подразделение, группу или роль), но и содержащиеся в нем вложенные элементы более низких уровней.
+
Дальнейшие действия по синхронизации повторяют шаги, описанные выше.
+
[NOTE]
====
Состав роли синхронизируется только в случае, если соответствующие записи уже есть в справочнике сотрудников.
====
