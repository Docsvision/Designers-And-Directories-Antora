= Справочник контрагентов

_Справочник контрагентов_ предназначен для хранения информации о структуре и сотрудниках внешних организаций, с которыми взаимодействует компания.

Структура справочника контрагентов и справочника сотрудников аналогична. Справочники представляет собой дерево, в корневом каталоге которого размещаются карточки организаций, которые, в свою очередь, могут состоять из более мелких подразделений.

Подразделения и организации можно объединять в иерархически организованные группы по какому-либо признаку (например, поставщики металла, рекламодатели и пр.).

Справочник может редактироваться одновременно несколькими пользователями, при этом используется блокировка на уровне записи сотрудника или подразделения.

[#interface]
== Интерфейс справочника

.Главное окно _Справочника контрагентов_ включает две вкладки:
* <<companies,"Организации">>.
* <<groups,Вкладка "Группы">>.

[#companies]
=== Вкладка "Организации"

Окно вкладки _Организации_ представлено на рисунке ниже.

.Вкладка "Организации" справочника контрагентов
image::partners-companies.png[Вкладка "Организации" справочника контрагентов]

.Команды ленты на вкладке "Организации"
[cols="10%,90",options="header"]
|===
|Команда |Описание

|image:buttons/add-partner-company.png[Добавить организацию контрагента]
|Добавить организацию. Откроет окно создания новой карточки организации.

|image:buttons/add-partner-dept.png[Добавить подразделение контрагента]
|Добавить подразделение. Откроет окно создания новой карточки подразделения.

|image:buttons/edit-partner-dept.png[Изменить подразделение контрагента]
|Редактировать подразделение. Редактирование карточки подразделения.

|image:buttons/delete-partner-dept.png[Удалить подразделение контрагента]
|Удалить подразделение. Удалит карточку подразделения.

|image:buttons/add-partner-employee.png[Добавить сотрудника контрагента]
|Добавить сотрудника. Откроет окно создания карточки сотрудника.

|image:buttons/edit-partner-employee.png[Изменить сотрудника контрагента]
|Редактировать сотрудника. Откроет окно редактирования карточки сотрудника.

|image:buttons/delete-partner-employee.png[Удалить сотрудника контрагента]
|Удалить сотрудника. Удалит карточку сотрудника.

|image:buttons/display-partner-employee-fields.png[Отображаемые поля сотрудников контрагента]
|Отображаемые поля сотрудников. Изменяет отображение данных о сотрудниках организации (подразделения) на правой панели справочника.

|image:buttons/show-partner-dept-fields.png[Отображаемые поля подразделений контрагента]
|Отображаемые поля подразделений. Изменяет отображение данных о подразделении на правой панели справочника.

|image:buttons/partner-unique-attrs.png[Уникальные атрибуты контрагентов]
|Уникальные атрибуты контрагентов. Определяет состав полей, проверяемых на уникальность при сохранении карточки.

|image:buttons/display-partner-subordinate.png[Показывать все подчиненные элементы контрагента]
|Показывать все подчиненные элементы. Оторажает дочерние элементы выбранной папки всех уровней подчиненности. Отключение этой кнопки приводит к отображению на правой панели только тех сотрудников, которые работают непосредственно в указанной организации, но не в её дочерних организациях.

|image:buttons/display-partner-employees-depts.png[Показывать сотрудников или подразделения контрагента]
a|Показывать сотрудников или подразделения. Позволяет изменять режим просмотра сведений об организации или подразделении:

* *Показывать подразделения* -- в этом режиме на правой панели отображаются подразделения, входящие в состав организации или подразделения, выделенной в дереве на левой панели.
* *Показывать сотрудников* -- в этом режиме на правой панели отображается список сотрудников, работающих в организации или подразделении, выделенной в дереве на левой панели.

При выборе корневого элемента дерева -- _Организации_, кнопка становится недоступной.

|image:buttons/display-employee-count.png[Показывать количество сотрудников]
|Показывать количество сотрудников. Отображает численность сотрудников, входящих в организацию, выбранную на левой панели. Также отображает (через косую черту) численность сотрудников организации, включая все подразделения.

В режиме просмотра сотрудников кнопка доступна только для корневого элемента дерева _Организации_.

Данная кнопка активна, когда задействован режим отображения подразделений. Число сотрудников отображается в колонке _Количество сотрудников_ напротив соответствующего подразделения в виде двух цифр через дробь (например, `2/10`). Первая цифра означает количество сотрудников в текущей организации или подразделении, а вторая -- общее число в данной ветке, включая сотрудников в подчиненных организациях или подразделениях.

|image:buttons/magn-glass.png[Лупа]
|Поиск. Отображает поля поиска в нижней правой части окна справочника.

|image:buttons/excel.png[Excel]
|Экспорт в Excel. Экспортирует данные справочника в Microsoft Excel. При нажатии кнопки открывается файл Microsoft Excel, содержащий сведения, отображенные на правой панели.

|image:buttons/refresh.png[Обновить]
|Обновить. Обновляет данные справочника.
|===

[#groups]
=== Вкладка "Группы"

Вкладка _Группы_ представлена на рисунке ниже.

.Вкладка "Группы"
image::partner-groups-tab.png[Вкладка "Группы"]

[cols="10%,90",options="header"]
|===
|Команда |Описание

|image:buttons/add-partner-group.png[Добавить группу контрагентов]
|Добавление новой группы.

|image:buttons/edit-partner-group.png[Изменить группу контрагентов]
|Редактирование параметров ранее созданной группы.

|image:buttons/delete-partner-group.png[Удалить группу контрагентов]
|Удаление группы.

|image:buttons/add-partner-dept-company.png[Добавить организацию или подразделение в группу контрагентов]
|Добавление организации в группу.

|image:buttons/edit-partner-dept.png[Изменить подразделение контрагента]
|Редактирование параметров организации в группе.

|image:buttons/delete-partner-dept-company.png[Удалить подразделение контрагента]
|Удаление организации из группы.

|image:buttons/display-partner-group-fields.png[Отображаемые поля подразделений в группе]
|Настройка отображаемых полей организаций в группе.
|===

Остальные команды аналогичны командам вкладки <<companies,Организации>>.

[#context]
=== Контекстное меню

Содержание контекстного меню _Справочника контрагентов_ зависит от выбранного элемента, во многом дублируя опции панели инструментов.

Доступны следующие операции: добавление, изменение, просмотр и удаление выделенного элемента, поиск, обновление окна справочника с учетном внесенных изменений, а также определение прав пользователей на доступ к элементам справочника.

В контекстном меню для каждого сотрудника на вкладке _Организации_ представлены команды, описыанные ниже.

Контекстное меню группы частично повторяет команды на панели инструментов справочника и содержит следующие команды:

* Добавить.
* Редактировать.
* Просмотреть.
* Удалить.
* Копировать.
* Обновить.
* Безопасность -- команда вызывает стандартный диалог настройки прав для пользователей и групп.

Команды добавления, редактирования и удаления идентичны соответствующим кнопкам ленты вкладки _Организации_.

.Контекстное меню вкладки "Группы"
image::partner-groups-tab-context.png[Контекстное меню вкладки "Группы"]

== Работа со справочником

.Администратор или пользователь, обладающий правами модификации справочника, может выполнять следующие действия:
* Добавление организации или подразделения.
* Добавление сотрудника.
* Изменение сведений об организации, подразделении или сотруднике.
* Удаление записи об организации, подразделении или сотруднике.
* Объединение подразделений и организаций в группы.
* Назначение пользователям прав доступа к элементам справочника (организация, подразделение, группа, сотрудник).
* Определение атрибутов, проверяемых на уникальность при сохранении карточки.
* Поиск данных в справочнике. Поиск может выполняться сотрудником без прав на модификацию справочника.
* Сортировка списка данных. Сортировка может выполняться сотрудником без прав на модификацию справочника.

Справочник контрагентов может быть открыт для редактирования несколькими пользователями одновременно, но во время сохранения изменений одним из пользователей справочник блокируется.

После добавления организации, подразделения или сотрудника, соответствующая запись становится активной (переходит в фокус) в окне справочника.

Однако у этого правила есть особенность: если фокус установлен только на дереве подразделений и организаций (выбрано какое-нибудь подразделение), то при добавлении Сотрудника, в правой части окна фокус на карточку сотрудника установлен не будет.

Если перейти в правую часть (с помощью kbd:[Tab] или просто щелкнув по пустой области), фокус установится на последнюю добавленную карточку. Если же изначально фокус стоял и на дереве подразделений (выбрано подразделение), и на списке сотрудников (выбрана карточка сотрудника), то при добавлении нового сотрудника фокус сразу устанавливается на добавленную карточку.

[NOTE]
====
Для заполнения справочника из `.xls` файла может использоваться утилита _TOPartnersLoad_.
====
