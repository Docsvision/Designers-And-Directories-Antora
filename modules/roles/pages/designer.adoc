= Конструктор ролей

_Конструктор ролей_ предназначен для разграничения полномочий разных пользователей системы. Основная функция конструктора заключается в управлении разрешёнными действиями при выполнении определённых условий.

Конструктор ролей использует понятие роли, которая определяется как набор настроенных условий. Одновременно пользователь может исполнять несколько ролей. Доступность операций определяются ролью пользователя и состоянием карточки.

В настройку ролевой модели входит создание ролей пользователей, работающих с приложением, и настройка доступности операций.

[WARNING]
====
Перед началом настройки ролевой модели в _Справочник сотрудников_ должны быть внесены данные обо всех сотрудниках организации, которые должны работать в системе {dv}.
====

[#interafce]
== Интерфейс конструктора

Главное окно _Конструктора ролей_ представлено на рисунке ниже.

.Интерфейс "Конструктора ролей"
image::roles-interface.png[Интерфейс "Конструктора ролей"]

.Главное окно состоит из следующих элементов:
* Ленты, включающей поля _Библиотека карточек_ и _Вид карточки_, а также кнопки для сохранения изменений и блокирования или разблокирования вида для редактирования.
* xref:roles/designer.adoc#roles-tab[Вкладки "Роли"].
* xref:roles/designer.adoc#access-matrix[Вкладки "Матрица доступа"].

[#roles-tab]
== Вкладка "Роли"

Вкладка _Роли_ предназначена для настройки _Ролевой модели_, то есть для создания и настройки ролей пользователей.

Левая панель данной вкладки включает список всех настроенных ролей, а правая -- дерево условий, сформированных для роли, выделенной на левой панели.

.Главное окно "Конструктора ролей"
image::roles-designer.png[Главное окно "Конструктора ролей"]

[#roles-list]
=== Область "Список ролей"

Область предназначена для просмотра списка доступных ролей.

[#conditions-tree]
=== Область "Дерево условий"

Область предназначена для настройки условий, сформированных для роли. Область включает три столбца, соответствующих атрибутам условия:

* _Параметр_ -- то, относительно чего формулируется условие, субъект настройки роли.
* _Операция_ -- логическое условие из списка доступных условий. Набор доступных условий зависит от выбранного параметра.
* _Значение_ -- секция карточки или поле, объект настройки роли.

Допускается группировка параметров при помощи логических операторов `И` или `ИЛИ`. Данные операторы являются узловыми элементами дерева условий. По умолчанию все параметры объединены только в одну группу (то есть имеется только один узловой элемент).

.Лента области _Дерево условий_ включает следующие команды:
[cols="10%,25%,65",options="header"]
|===
|Кнопка |Название |Назначение
|image:buttons/condition-group-add.png[Добавить группу условий]
|*Добавить группу условий* |Добавляет новую пустую группу условий в текущую выбранную группу (если выбрана группа) или в родительскую группу (если выбрано условие).

|image:buttons/condition-add.png[Добавить условие]
|*Добавить условие* |Добавляет условие в текущую выбранную или родительскую группу (аналогично добавлению группы).

|image:buttons/condition-group.png[Группировать условия]
|*Группировать условия* |Группирует выделенные условия/группы, создавая новую группу, содержащую выбранные условия и/или группы.

|image:buttons/condition-ungroup.png[Разгруппировать условия]
|*Разгруппировать условия* |Переносит все элементы выделенной группы в родительскую группу, удаляет выбранную группу; доступно только при выбранной группе (не корневой).

|image:buttons/x-red.png[Красный крестик]
|*Удалить элемент* |Удаляет выбранное условие/группу (с предварительным уточняющим вопросом).
|===

[#access-matrix]
== Вкладка "Матрица доступа"

Вкладка _Матрица доступа_ предназначена для назначения прав на элементы выбранного вида карточки.

.Права пользователя на элемент системы определяются тремя параметрами:
* Ролью, которую исполняет пользователь.
* Состоянием карточки.
* Выполняемой операцией.

Список операций в матрице доступа соответствует операциям для выбранного вида в _Конструкторе состояний_.

.Вкладка "Матрица доступа"
image::access-matrix.png[Вкладка "Матрица доступа"]

.Вкладка включает следующие элементы:
* Поле _Тип объекта_, предназначенное для выбора объекта, относительно которого определяется доступность операции над карточкой.
* Поле _Объект_, предназначенное для определения объекта выбранного типа.
* _Матрицу доступа_ -- таблицу, в заголовках строк и столбцов которой отображаются названия всех объектов двух оставшихся типов. В ячейках этой таблицы проставляется статус операций (_Разрешена_, _Не разрешена_, _Запрещена_). Для повышения удобства использования, в таблице прав при прокрутке закреплены заголовки столбцов и строк. При выборе операции или редактировании определённой ячейки в матрице доступа выделяется вся изменяемая строка.

[#role-filter]
=== Область "Ролевой фильтр"

Область содержит поля для получения сведений о ролях, исполняемых пользователем при работе с некоторой карточкой:

* Флаг `_Включить фильтр ролей_` для активации фильтра.
* Поля _Сотрудник_ и _Карточка_ для просмотра доступных ролей выбранного сотрудника и карточки. Список ролей будет отфильтрован в соответствии с этими параметрами.
