= Добавить условие

_Условие_ -- правило, состоящее из связки _параметр-операция-значение_. Условие устанавливает связь между субъектом (например, текущим пользователем) и объектом системы (например, значением поля карточки).

[#steps]
.Чтобы добавить условия запроса для роли:
. Перейдите на вкладку _Роли_.
. Выберите в области _Список ролей_ роль, для которой требуется добавить условие.
. Выделите группу условий.
. Нажмите кнопку image:buttons/condition-add.png[Добавить условие] *Добавить условие*.
. Щелкните левой клавишей мыши на поле столбца _Параметр_, чтобы открыть список доступных условий.
+
.Выбор параметра для условия роли
image::condition-parameter.png[Выбор параметра для условия роли]
+
. В добавленной строке в столбце _Параметр_ выберите нужный параметр из <<param-values,списка>>.
+
По умолчанию установлен параметр *_Я_*.
+
. Перейдите к столбцу _Операция_.
. Выберите логическое условие.
+
Список доступных операций зависит от выбранного <<param-values,параметра>> и будет разным у _сотрудников_, _параметров времени и даты_ и _полей карточки_. По умолчанию установлено условие _Равно_
+
. Перейдите к столбцу _Значение_.
. Нажмите кнопку с многоточием.
. Выберите значение для параметра в соответствии со <<param-values,Списком>> допустимых значений.
+
* <<employee-param-values,Для параметра типа "Сотрудник">>.
* <<today-param-values,Для параметра "Сегодня">>.
* <<now-param-values,Для параметра "Сейчас">>.
* <<field-condition-add,Для параметра "Поле">>.
+
Состав доступных вариантов для выбора в столбце _Значение_ различается в зависимости от значений столбцов _Параметр_ и _Операция_.
+
Чтобы настроенные роли работали для только что созданной, но ещё не сохранённой карточки, необходимо создать роль _Все_ и дать ей права в начальном состоянии карточки.

[#params]
== Список "Параметров" для условия

[cols="40%,60",options="header"]
|===
|Параметр |Описание

|*_Все_*
|Условие задаётся относительно всех пользователей.

|*_Я_*
|Условие задаётся относительно текущего пользователя.

|*_Руководитель_*
|Условие задаётся относительно руководителя текущего пользователя.

|*_Подчиненные_*
|Условие задаётся относительно подчиненных первого уровня текущего пользователя.

|*_Все подчиненные_*
|Условие задаётся относительно всех подчиненных текущего пользователя.

|*_Все подчиненные временноЗамещаемого_*
|Условие задаётся относительно заместителя временно замещаемого руководителя текущего пользователя.

|*_Все подчиненные постоянноЗамещаемого_*
|Условие задаётся относительно заместителя постоянно замещаемого руководителя текущего пользователя.

|*_Заместитель_*
|Условие задаётся относительно заместителя текущего пользователя.

|*_Замещаемый_*
|Условие задаётся относительно лица, заместителем которого является текущий пользователь.

|*_Я -- первый активный заместитель_*
|Условие задаётся относительно первого активного заместителя текущего пользователя.

Первым заместителем считается сотрудник, который первым указан в списке заместителей в _Справочнике сотрудников_. У данного сотрудника должно быть состояние `Активен`.

|*_Я -- первый активный постоянный заместитель_*
|Условие задаётся относительно первого активного заместителя текущего пользователя.

Данный заместитель считается постоянным на основании установленного параметра `*Постоянный заместитель*` в _Справочнике сотрудников_. У данного сотрудника должно быть состояние `Активен`.

|*_Я -- первый активный временный заместитель_*
|Условие задаётся относительно первого активного заместителя текущего пользователя.

Данный заместитель считается временным на основании того, что для него не установлен параметр `*Постоянный заместитель*` в _Справочнике сотрудников_. У данного сотрудника должно быть состояние `Активен`.

|*_Я -- первый активный заместитель исполнения_*
|Условие задаётся относительно первого активного заместителя текущего пользователя. Данный статус настраивается в _Справочнике сотрудников_.

|*_Я -- первый активный заместитель ответственного исполнения_*
|Условие задаётся относительно первого активного заместителя исполнителя текущего пользователя, причём для заместителя установлена настройка `*Ответственное исполнение*`. Данный статус настраивается в _Справочнике сотрудников_.

|*_Я -- первый активный заместитель подписи_*
|Условие задаётся относительно первого активного заместителя текущего пользователя по подписи. Данный статус настраивается в _Справочнике сотрудников_.

|*_Я -- временный заместитель в период неактивности замещаемого_*
|Условие задаётся относительно первого активного заместителя, но только в случае, когда замещаемый сотрудник находится в состоянии, отличном от `Активен`. У данного сотрудника должно быть состояние `Активен`.

|*_Я -- постоянный заместитель_*
|Условие задаётся относительно постоянного заместителя вне зависимости от активности заместителя и самого замещаемого. Данный заместитель считается постоянным на основании установленного параметра `*Постоянный заместитель*` в _Справочнике сотрудников_.

|*_Я -- заместитель подписи_*
|Условие задаётся относительно заместителя текущего пользователя по подписи.

|*_Сегодня_*
|Условие задаётся относительно текущей даты без учета бизнес-календаря.

|*_Сейчас_*
|Условие задаётся относительно текущего момента времени без учета бизнес-календаря.

|*_Поле_*
|Условие задаётся относительно некоторого поля карточки.
|===

[#param-values]
== Список "Значений" для параметров

[cols="25%,20%,55",options="header"]
|===
|Параметр |Условие |Значение

|Все
|Нет
|Условия и их значения не задаются, все пользователи смогут выполнять операции согласно Матрице доступа.

a|Я

Руководитель

Подчиненный

Заместитель

Замещаемый

a|Равно

Не равно

|<<employee-param-values,Выберите>> значения для параметра типа "Сотрудник".

a|Я

Руководитель

Подчиненный

Заместитель

Замещаемый

|Является руководителем
|Значение не задаётся, оно выполняется для всех пользователей, являющихся руководителями в своих подразделениях.

a|Я

Руководитель

Подчиненный

Заместитель

Замещаемый

|В том же подразделении
|<<employee-param-values,Выберите>> значения для параметра типа "Сотрудник".

a|Я

Руководитель

Подчиненный

Заместитель

Замещаемый

a|В группе с подчиненными

//В группе без подчинённых
//
Не в группе

//В подразделении с подчиненными
//
В подразделении без подчиненных

Не в подразделении

|Значением является подразделение или группа, которые выбираются из _Справочника сотрудников_.
|Сегодня

a|Равно

Не равно

|<<today-param-values,Выберите>> значения для параметра "Сегодня".
|Сейчас

a|Равно

Не равно

Больше

Больше или равно

Меньше

Меньше или равно

|<<now-param-values,Выберите>> значения для параметра "Сейчас".

|<Поле...>
|Нет
|<<field-condition-add,Добавление условия на поле карточки>>.
|===

[#employee-field-ops]
== Список операций для поля типа "Сотрудник"

[WARNING]
====
Условия, связанные с группами, соблюдаются, в том числе, если текущий сотрудник входит в любую подгруппу выбранной группы.
====

[cols="25%,75",options="header"]
|===
|Операция |Описание

|Равно
|Операция предназначена для поиска сотрудников, указанных в определённом поле карточки.

В поле _Значение_ необходимо выбрать секцию и поле, где записаны сотрудники. Роль будет соблюдаться, если выбранные и текущие сотрудники совпадут.

|Не равно
|Операция предназначена для поиска сотрудников, отличных от тех, что указаны в определённом поле карточки.

В поле _Значение_ необходимо выбрать секцию и поле, где записаны сотрудники. Роль будет соблюдаться, если выбранные и текущие сотрудники не совпадут.

|Является руководителем
|Поле _Значение_ не заполняется.

Роль будет соблюдаться, если сотрудник, указанный в поле _Параметр_, является Руководителем. См. <<param-values,Список "Значений" для параметров>>.

|В том же подразделении
|Операция предназначена для поиска сотрудников, относящихся к тому же подразделению, что и указанный сотрудник.

В поле _Значение_ необходимо выбрать сотрудника. Роль будет соблюдаться, если подразделения выбранного и текущего пользователей совпадут.

|В группе с подчиненными
|Операция предназначена для поиска сотрудников, входящих в определённую группу _Справочника сотрудников_ или подчинённые ей. В поле _Значение_ необходимо выбрать Группу.

Роль будет соблюдаться, если текущий сотрудник входит в указанную группу или подчинённые ей.

//|В группе без подчинённых
//|Операция предназначена для поиска сотрудников, входящих в определённую группу _Справочника сотрудников_. В поле _Значение_ необходимо выбрать Группу.
//
//Роль будет соблюдаться, если текущий сотрудник входит в указанную группу.

|Не в группе
|Операция предназначена для поиска сотрудников, не входящих в определённую группу _Справочника сотрудников_. В поле _Значение_ необходимо выбрать Группу.

Роль будет соблюдаться, если текущий сотрудник не входит в указанную группу.

|В группе из поля карточки
|Операция предназначена для поиска сотрудников, входящих в определённую группу, указанную в поле карточки. В поле _Значение_ необходимо выбрать поле карточки с соответствующим типом.

Роль будет соблюдаться, если текущий сотрудник входит в группу из поля карточки.

|В подразделении без подчиненных
|Операция предназначена для поиска сотрудников, входящих в определённое подразделение справочника сотрудников. В поле _Значение_ необходимо выбрать подразделение.

Роль будет соблюдаться, если текущий сотрудник входит в указанное подразделение.

|Не в подразделении
|Операция предназначена для поиска сотрудников, не входящих в определённое подразделение справочника сотрудников. В поле _Значение_ необходимо выбрать подразделение.

Роль будет соблюдаться, если текущий сотрудник не входит в указанное подразделение.
|===

[#employee-param-values]
== Выбор значения для параметра типа "Сотрудник"

.Чтобы указать значение для параметра типа "Сотрудник":
. Выполните шаги 1-9 операции <<steps,Добавление условия>>.
+
.Выбор значения для условия
image::condition-value-employee.png[Выбор значения для условия]
+
. Если для проверки условия будет использоваться значение поля карточки, выберите опцию *Поле* и заполните поля:
+
.. В поле _Секция_ укажите секцию карточки, в которой находится поле для проверки условия.
+
Раскрывающийся список поля содержит перечень всех _корневых_ секций карточки. Необходимо учитывать, что если в _Конструкторе разметок_ были созданы вложенные секции (т.е. находящиеся внутри родительских секций), то в данном окне их выбор будет невозможен.
+
.. Укажите _Поле_ карточки, значение которого будет использоваться для проверки условия.
+
Поле активно, если уже выбрана секция. Раскрывающийся список поля содержит перечень всех полей выбранной секции, ссылающихся на справочники и карточки.
+
.. В поле _Ссылочная секция_ укажите секцию карточки, на которую ссылается выбранное поле, и в котором находится поле ссылочной карточки для проверки.
+
Поле активно, если указано значение _Поле_, ссылающееся на карточку. Раскрывающийся список поля содержит перечень секций карточки, на которую ссылается выбранное поле.
+
.. В поле _Ссылочное поле_ укажите либо поле ссылочной строки (если выбрано _Поле_, ссылающееся на справочник), либо поле выбранной секции ссылочной карточки (если выбрано _Поле_, ссылающееся на карточку).
+
Раскрывающийся список поля содержит перечень полей секции ссылочной строки или выбранной секции ссылочной карточки. Поле доступно, если:
+
* Выбрано _Поле_, ссылающееся на справочник.
* Выбрано _Поле_, ссылающееся на карточку, и при этом указана секция ссылочной карточки.
+
. Если требуется указать название ранее сохранённой в базе данных хранимой процедуры, выберите опцию *Хранимая процедура*.

[#today-param-values]
== Выбор значения для параметра "Сегодня"

.Чтобы указать значение для параметра типа "Сегодня":
. Выполните шаги 1-9 операции <<steps,Добавление условия>>, чтобы открыть окно _Выбор значения_.
+
.Выбор значения для условия
image::condition-value-today.png[Выбор значения для условия]
+
. Заполните поля окна.
. Нажмите на кнопку *Принять*.

[#now-param-values]
== Выбор значения для параметра "Сейчас"

.Чтобы указать значение для параметра типа "Сегодня":
. Выполните шаги 1-9 операции <<steps,Добавление условия>>, чтобы открыть окно _Выбор значения_.
+
.Выбор значения для условия
image::condition-value-now.png[Выбор значения для условия]
+
. Заполните поля окна.
. Нажмите на кнопку *Принять*.

[#field-condition-add]
== Добавление условия на поле карточки

Добавление условий выполняется при выборе параметра типа _Поле_.

.Чтобы добавить условие на поле карточки:
. Выполните шаги 1-9 операции <<steps,Добавление условия>>, чтобы открыть окно _Условие на поле карточки_.
+
.Условие на поле карточки
image::field-condition.png[Условие на поле карточки]
+
. В поле _Секция_ выберите название секции, в которой расположено нужное поле.
+
Если в _Конструкторе разметок_ были созданы вложенные секции (т.е. находящиеся внутри родительских секций), то в данном окне их нельзя будет выбрать.
+
. Выберите _Поле_, относительно которого задаётся условие.
. В поле _Операция сравнения_ выберите операцию, доступную для поля данного типа.
. Введите _Значение_ поля в зависимости от типа поля.
. Нажмите на кнопку *Принять*.
